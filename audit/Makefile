# USDTgVerse Pure C Audit System Makefile
# Author: Irfan Gedik
# Version: 1.0

CC = gcc
CFLAGS = -Wall -Wextra -std=c99 -O2 -pthread
LDFLAGS = -pthread
TARGETS = audit_api_c_native audit_api_real_production
SOURCES = audit_api_c_native.c audit_api_real_production.c

# Default target
all: $(TARGETS)

# Build native audit API
audit_api_c_native: audit_api_c_native.c
	@echo "ğŸ”§ Building audit_api_c_native..."
	$(CC) $(CFLAGS) -o audit_api_c_native audit_api_c_native.c $(LDFLAGS)
	@echo "âœ… audit_api_c_native built successfully"

# Build production audit API
audit_api_real_production: audit_api_real_production.c
	@echo "ğŸ”§ Building audit_api_real_production..."
	$(CC) $(CFLAGS) -o audit_api_real_production audit_api_real_production.c $(LDFLAGS)
	@echo "âœ… audit_api_real_production built successfully"

# Run native audit API
run-native: audit_api_c_native
	@echo "ğŸš€ Starting native audit API server..."
	./audit_api_c_native

# Run production audit API
run-production: audit_api_real_production
	@echo "ğŸš€ Starting production audit API server..."
	./audit_api_real_production

# Run both servers (in background)
run-both: audit_api_c_native audit_api_real_production
	@echo "ğŸš€ Starting both audit API servers..."
	./audit_api_c_native &
	./audit_api_real_production &
	@echo "âœ… Both servers started in background"
	@echo "ğŸŒ Native API: http://localhost:8080"
	@echo "ğŸŒ Production API: http://localhost:8081"

# Stop all servers
stop:
	@echo "ğŸ›‘ Stopping all audit API servers..."
	@pkill -f audit_api_c_native || true
	@pkill -f audit_api_real_production || true
	@echo "âœ… All servers stopped"

# Clean build files
clean:
	@echo "ğŸ§¹ Cleaning build files..."
	rm -f $(TARGETS)
	@echo "âœ… Clean completed"

# Install dependencies
install-deps:
	@echo "ğŸ“¦ Installing dependencies..."
	@echo "âœ… No external dependencies required (Pure C)"

# Test the APIs
test:
	@echo "ğŸ§ª Testing audit APIs..."
	@echo "Testing native API..."
	@curl -s http://localhost:8080/contracts | head -c 100 || echo "âŒ Native API not running"
	@echo ""
	@echo "Testing production API..."
	@curl -s http://localhost:8081/contracts | head -c 100 || echo "âŒ Production API not running"

# Show help
help:
	@echo "USDTgVerse Pure C Audit System Makefile"
	@echo ""
	@echo "Available targets:"
	@echo "  all              - Build all targets"
	@echo "  audit_api_c_native - Build native audit API"
	@echo "  audit_api_real_production - Build production audit API"
	@echo "  run-native       - Run native audit API server"
	@echo "  run-production   - Run production audit API server"
	@echo "  run-both         - Run both servers in background"
	@echo "  stop             - Stop all servers"
	@echo "  clean            - Clean build files"
	@echo "  install-deps     - Install dependencies"
	@echo "  test             - Test the APIs"
	@echo "  help             - Show this help"
	@echo ""
	@echo "Examples:"
	@echo "  make all         - Build everything"
	@echo "  make run-both    - Start both servers"
	@echo "  make test        - Test running servers"

.PHONY: all run-native run-production run-both stop clean install-deps test help
